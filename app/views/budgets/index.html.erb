<% html_title "Budgets" %>
<h2>Budgets</h2>

<!--option -->
<%= form_tag url_for(action: :index), method: :get, id: "query_form" do %>
  <fieldset id="filters" class="collapsible">
    <legend onclick="toggleFieldset(this);" class="icon icon-collapsed"><%= l(:label_options) %></legend>
    <div style="display: none;">
      <!-- basis date -->
      <div class="evm-div-col">
        <fieldset><legend><%= l(:label_basis_date) %></legend>
          <%= date_field_tag("basis_date", @cfg_param[:basis_date], size: 8) %><%= calendar_for("basis_date") %>
        </fieldset>
      </div>
      <!-- selectable assignee -->
      <div class="evm-div-col">
        <fieldset><legend><%= l(:label_select_assignee) %></legend>
          <%= select_tag :selected_assignee_id,
              options_for_select(@selectable_assignees,
                                @cfg_param[:selected_assignee_id]),
                                { multiple: true, size: 5 }%>
        </fieldset>
      </div>
    </div>
  </fieldset>
  <!-- Apply button -->
  <p class="buttons">
    <%= link_to "#", {onclick: "$(this).closest('form').submit()", class: "icon icon-checked" } do l(:button_apply) end %>
    <%= link_to l(:button_clear), { basis_date: Date.today }, :class => "icon icon-reload"  %>
  </p>
<% end %>

<%= form_tag({}, :data => {:cm_url => issues_context_menu_path}) do -%>
<%= hidden_field_tag 'back_url', url_for(:params => request.query_parameters), :id => nil %>
<ul class="cal">
  <li class="budgetuser">
    <%= "#{@user}" %>
  </li>
  <% @calendar.format_month.each do |day| %>
    <li class="<%= @calendar.day_css_classes day %> budgetbody">
      <p class="day-num"><%= day.day %>
        <span class="abbr-day">(<%= abbr_day_name(day.cwday) %>)</span>
      </p>
      <% @calendar.events_on(day).each do |i| %>
        <% if i.is_a? Issue %>
          <%= tag.div class: [ i.css_classes, 'tooltip hascontextmenu', starting: day == i.start_date, ending: day == i.due_date] do %>
            <%= "#{i.project} -" unless @project && @project == i.project %>
            <%= link_to_issue i, :truncate => 30 %>
            <span class="tip"></span>
            <%= check_box_tag 'ids[]', i.id, false, :style => 'display:none;', :id => nil %>
          <% end %>
        <% else %>
          <span class="icon icon-package">
            <%= "#{i.project} -" unless @project && @project == i.project %>
            <%= link_to_version i %>
          </span>
        <% end %>
      <% end %>
    </li>
  <% end %>
</ul>
<% end %>
<%= context_menu %>
